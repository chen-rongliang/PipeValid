/*! pipe-valid-2.0.3 by da宗熊 ISC https://github.com/linfenpan/PipeValid#readme*/
!function(t,n){"object"==typeof module?module.exports=n():"function"==typeof define?define.amd?define(n):define(function(t,e,r){r.exports=n()}):"object"==typeof exports?module.exports=n():t.PipeValid=n()}(this,function(t){"use strict";function n(){}function e(t){return Object.prototype.toString.call(t).split(" ")[1].slice(0,-1).toLowerCase()}function r(t){return"function"===e(t)}function i(t){return"object"===e(t)}function u(t){return"array"===e(t)}function c(t){return t.trim?t.trim():t.replace(/^\s*|\s*$/,"")}function o(t){return[].slice.call(t,0)}function s(t,n){a(n,function(n,e){t[n]=e})}function a(t,n){for(var e in t)t.hasOwnProperty(e)&&n.call(t,e,t[e])}function f(t,n){for(var e=0,r=t.length;e<r;e++)n.call(t,t[e],e)}function h(t,e){e=e||{};var r=e.next||n,i=e.callback||n;if(t&&t.length>0){r(t.shift(),function(){h(t,e)})}else i()}function l(t,n,e){for(var r,i=e||n.match(y),o=!0,s=(function(n){n in t?t=t[n]:o=!1});i.length;)if(r=c(i.shift())){if(x.test(r)){var a=r.match(x),h=a[1];if(h)s(h);else{if(u(t)){var p=[];return f(t,function(t){var n=l(t,null,i.slice(0));p.push.apply(p,n)}),p}o=!1}}else"."!==r&&s(r);if(!o)break}return o?[{value:t}]:[{nonexist:!0}]}function p(){this._a=[],this._b=null,this._c=b}function d(t){this.parent=t,this._d()}function v(t,e,r){var i={ctx:t};return a(g,function(u,c){i[u]=function(){var i=o(arguments),u=i.splice(c.length-1)[0],s=c.apply(t,[e].concat(i));return s?s.then&&s.then(n,function(t){r(t||u)}):u&&r(u),s}}),i}function _(t,n){return g[t]||(g[t]=n),function(){var e=n.length-1,r=o(arguments),i=r.slice(Math.min(r.length,e))[0];return this.current.run.push([t,r.slice(0,e),i]),this}}function m(){this.validers={}}var y=/([^.\[\]]+)|(\[\d*\]|\.)/g,x=/^\[(\d*)\]$/,b="pending";p.prototype={_e:function(t){for(var n,e=this._c,r=this._a;n=r.shift();)"done"===e?n.done&&(t=n.done.call(this,t)):n.fail&&(t=n.fail.call(this,t)),this._b=t;return this},_f:function(t,n){return this._c===b?(this._c=t,this._b=n,this._e(n)):this},resolve:function(t){return this._f("done",t)},reject:function(t){return this._f("fail",t)},then:function(t,n){return this._a.push({done:t,fail:n}),this._c!==b?this._e(this._b):this},always:function(t){return this.then(t,t)},catch:function(t){return this.then(null,t)}};var g={max:function(t,n){return(t=""+t)&&t.length<=n},min:function(t,n){return(t=""+t)&&t.length>=n},notEmpty:function(t){return null!=t&&!/^\s*$/g.test(t)},url:function(t){return/^(https?:|ftp:)?\/\/([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w \.-]*)*\/?$/.test(t)},email:function(t){return/^([a-z0-9_\.-]+)@([\da-z\.-]+)\.([a-z\.]{2,6})$/.test(t)},number:function(t){return!isNaN(Number(t))},int:function(t){return/^-?\d+$/.test(t)},gt:function(t,n){return Number(t)>n},gte:function(t,n){return Number(t)>=n},lt:function(t,n){return Number(t)<n},lte:function(t,n){return Number(t)<=n}};return d.prototype={_d:function(){this.conditions=[],this.current={},this._g()},_g:function(){var t=this.current;t.run&&t.run.length<=0&&this.conditions.pop(),t=this.current={when:[],run:[]},this.conditions.push(t)},check:function(){var t=this.parent;return t.check.apply(t,arguments)},define:function(t){var n=t.length-1,e=o(arguments).slice(1),r=e.slice(n)[0];return this.current.run.push([t,e.slice(0,n),r]),this},custom:function(t){var n=function(n){var e=new p,r=function(t){if(t)throw e.reject(t),"_h";e.resolve()},i=v(this,n,r),u=[n,r].concat(o(arguments).slice(1));try{t.apply(i,u)}catch(t){if("_h"!==t)throw t}return e},e=o(arguments);return this.current.run.push([n,e.slice(1)]),this},then:function(){var t=this.current;return t.when=t.run.slice(0),t.run=[],this},end:function(){return this._g(),this},start:function(t,n){var e=this;h(this.conditions.slice(0),{next:function(r,i){e._i(t,r,function(t){t?n(t):i()})},callback:function(){n.call(e)}})},_i:function(t,n,e){var r=this;this._j(t,n.when.slice(0)).then(function(){r._j(t,n.run.slice(0)).then(function(){e()}).catch(e)}).catch(function(){e()})},_j:function(t,n){var e=this,r=new p;return h(n,{next:function(n,i){var u=e._k(n,t),c=u.fn,o=u.key,s=u.error||o,a=u.params,f=c.apply(e,a),h={type:o,error:s};f&&f.then?f.then(i,function(t){t&&(h.error=t),r.reject(h)}):f?i():r.reject(h)},callback:function(){r.resolve()}}),r},_k:function(t,n){var e=t[0];return{key:e,fn:r(e)?e:g[e],params:[n].concat(t[1]||[]),error:t[2]}}},function(){var t=d.prototype;a(g,function(n,e){t[n]=_(n,e)})}(),m.prototype={define:function(t,n){return m.define(t,n),this},check:function(t){if(i(t))return this.rule(t);var n=this.validers[t]||(this.validers[t]=new d(this));return n.end(),n},rule:function(t){var n=this,e=function(t,n){t[n[0]].apply(t,n.slice(1))};return a(t,function(t,r){if(u(r)){var i=n.check(t);i._d(),u(r[0])?f(r,function(t){e(i,t)}):e(i,r)}}),this},start:function(t,n,e){t=t||{},u(n)||(e=n,n=[]);var r=new p,i=this._l(t,n);return this._m(i,function(t){r.pass=!t,t?(e?r.error=t:s(r,t),r.reject(t)):r.resolve()},e),r},_m:function(t,n,e){var r=this,i=[];h(t,{next:function(t,u){var c=t.key,o=t.value;t.index;r.validers[c].start(o,function(c){c?(s(c,t),e?(i.push(c),u()):n.call(r,c)):u()})},callback:function(){n.call(r,i.length>0&&i)}})},_l:function(t,n){var e=this,r=this.validers,i=[],u=function(t){i.push.apply(i,t)};return n.length>0?f(n,function(n){r[n]&&u(e._n(t,n,!1))}):a(r,function(n,r){u(e._n(t,n,!0))}),i},_n:function(t,n,e){var r=[];return f(l(t,n),function(t,i){var u={key:n,value:t.value,index:i};t.nonexist?e||r.push(u):r.push(u)}),r}},m.define=function(t,n){d.prototype[t]=_(t,n)},s(m,{Thenable:p,checkers:g,Item:d}),m});
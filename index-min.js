/*! pipe-valid-2.0.0 by da宗熊 ISC https://github.com/linfenpan/PipeValid#readme*/
!function(t,n){"function"==typeof define?define.amd?define(n):define(function(t,e,i){i.exports=n()}):"object"==typeof exports?module.exports=n():t.PipeValid=n()}(this,function(t){"use strict";function n(){}function e(t){return Object.prototype.toString.call(t).split(" ")[1].slice(0,-1).toLowerCase()}function i(t){return"function"===e(t)}function r(t){return"object"===e(t)}function c(t){return"array"===e(t)}function u(t){return t.trim?t.trim():t.replace(/^\s*|\s*$/,"")}function o(t){return[].slice.call(t,0)}function s(t,n){a(n,function(n,e){t[n]=e})}function a(t,n){for(var e in t)t.hasOwnProperty(e)&&n.call(t,e,t[e])}function h(t,n){for(var e=0,i=t.length;e<i;e++)n.call(t,t[e],e)}function f(t,e){e=e||{};var i=e.next||n,r=e.callback||n;if(t&&t.length>0){var c=t.shift();i(c,function(){f(t,e)})}else r()}function l(t,n,e){for(var i,r=e||n.match(m),o=!0,s=(function(n){n in t?t=t[n]:o=!1});r.length;)if(i=u(r.shift())){if(g.test(i)){var a=i.match(g),f=a[1];if(f)s(f);else{if(c(t)){var p=[];return h(t,function(t){var n=l(t,null,r.slice(0));p.push.apply(p,n)}),p}o=!1}}else"."!==i&&s(i);if(!o)break}return o?[{value:t}]:[{nonexist:!0}]}function p(){this._records=[],this._param=null,this._state=k}function v(t){this.parent=t,this._reset()}function d(t,e,i){var r={ctx:t};return a(N,function(c,u){r[c]=function(){var r=o(arguments),c=r.splice(u.length-1)[0],s=u.apply(t,[e].concat(r));return s?s.then&&s.then(n,function(t){i(t||c)}):c&&i(c),s}}),r}function _(){var t=v.prototype;a(N,function(n,e){t[n]=x(n,e)})}function x(t,n){return N[t]||(N[t]=n),function(){var e=n.length-1,i=o(arguments),r=i.slice(Math.min(i.length,e))[0];return this.current.run.push([t,i.slice(0,e),r]),this}}function y(){this.validers={}}var m=/([^.\[\]]+)|(\[\d*\]|\.)/g,g=/^\[(\d*)\]$/,k="pending",b="done",w="fail";p.prototype={_exe:function(t){for(var n,e=this._state,i=this._records;n=i.shift();)e===b?n.done&&(t=n.done.call(this,t)):n.fail&&(t=n.fail.call(this,t)),this._pipeToNextThen(t);return this},_pipeToNextThen:function(t){return t instanceof p?(t._records=this._records.splice(0),t):(this._param=t,this)},_changeState:function(t,n){return this._state===k?(this._state=t,this._param=n,this._exe(n)):this},resolve:function(t){return this._changeState(b,t)},reject:function(t){return this._changeState(w,t)},then:function(t,n){return this._records.push({done:t,fail:n}),this._state!==k?this._exe(this._param):this},always:function(t){return this.then(t,t)},catch:function(t){return this.then(null,t)}};var N={max:function(t,n){return t=""+t,t&&t.length<=n},min:function(t,n){return t=""+t,t&&t.length>=n},notEmpty:function(t){return t&&!/^\s*$/g.test(t)},url:function(t){return/^(https?:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w \.-]*)*\/?$/.test(t)},email:function(t){return/^([a-z0-9_\.-]+)@([\da-z\.-]+)\.([a-z\.]{2,6})$/.test(t)},number:function(t){return!isNaN(Number(t))},int:function(t){return/^\d+$/.test(t)}};return v.prototype={_reset:function(){this.conditions=[],this.current={},this._buildNext()},_buildNext:function(){var t=this.current;t.run&&t.run.length<=0&&this.conditions.pop(),t=this.current={when:[],run:[]},this.conditions.push(t)},check:function(){var t=this.parent;return t.check.apply(t,arguments)},define:function(t){var n=t.length-1,e=o(arguments).slice(1),i=e.slice(n)[0];return this.current.run.push([t,e.slice(0,n),i]),this},custom:function(t){var n="__interrupt__",e=function(e){var i=new p,r=function(t){if(t)throw i.reject(t),n;i.resolve()},c=d(this,e,r),u=[e,r].concat(o(arguments).slice(1));try{t.apply(c,u)}catch(t){if(t!==n)throw t}return i},i=o(arguments);return this.current.run.push([e,i.slice(1)]),this},then:function(){var t=this.current;return t.when=t.run.slice(0),t.run=[],this},end:function(){return this._buildNext(),this},start:function(t,n){var e=this,i=this.conditions.slice(0);f(i,{next:function(i,r){e._startNext(t,i,function(t){t?n(t):r()})},callback:function(){n.call(e)}})},_startNext:function(t,n,e){var i=this;this._run(t,n.when.slice(0)).then(function(){i._run(t,n.run.slice(0)).then(function(){e()}).catch(e)}).catch(function(){e()})},_run:function(t,n){var e=this,i=new p;return f(n,{next:function(n,r){var c=e._parseCondition(n,t),u=c.fn,o=c.key,s=c.error||o,a=c.params,h=u.apply(e,a),f={key:o,error:s};h&&h.then?h.then(r,function(t){t&&(f.error=t),i.reject(f)}):h?r():i.reject(f)},callback:function(){i.resolve()}}),i},_parseCondition:function(t,n){var e=t[0];return{key:e,fn:i(e)?e:N[e],params:[n].concat(t[1]||[]),error:t[2]}}},_(),y.prototype={define:function(t,n){return y.define(t,n),this},check:function(t){if(r(t))return this.rule(t);var n=this.validers[t]||(this.validers[t]=new v(this));return n.end(),n},rule:function(t){var n=this,e=function(t,n){t[n[0]].apply(t,n.slice(1))};return a(t,function(t,i){if(c(i)){var r=n.check(t);r._reset(),c(i[0])?h(i,function(t){e(r,t)}):e(r,i)}}),this},start:function(t,n,e){t=t||{},c(n)||(e=n,n=[]);var i=new p,r=this._obtainValidList(t,n);return this._checkAll(r,function(t){i.pass=!t,t?(e?i.error=t:s(i,t),i.reject(t)):i.resolve()},e),i},_checkAll:function(t,n,e){var i=this,r=[];f(t,{next:function(t,c){var u=t.key,o=t.value,s=t.index,a=i.validers[u];a.start(o,function(t){t?(t.index=s,e?(r.push(t),c()):n.call(i,t)):c()})},callback:function(){n.call(i,r.length>0&&r)}})},_obtainValidList:function(t,n){var e=this,i=this.validers,r=[],c=function(t){r.push.apply(r,t)};return n.length>0?h(n,function(n){i[n]&&c(e._explainAttrToList(t,n,!1))}):a(i,function(n,i){c(e._explainAttrToList(t,n,!0))}),r},_explainAttrToList:function(t,n,e){var i=[];return h(l(t,n),function(t,r){var c={key:n,value:t.value,index:r};t.nonexist?e||i.push(c):i.push(c)}),i}},y.define=function(t,n){v.prototype[t]=x(t,n)},y});
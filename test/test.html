<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>PipeValid 2.0测试</title>
</head>
<body>

√ 1. 没有必要多个error值，干掉吧!<br/>
2. 能否 check('data.name') 呢? <br/>
3. 能否 check('list[].name') 呢? <br/>
4. 能否 check('list[0].name') 呢? <br/>
5. checkAll 功能还没有实现<br/>

<script src="../src/util.js"></script>
<script src="../src/thenable.js"></script>
<script src="../src/checker.js"></script>
<script src="../src/item.js"></script>
<script src="../src/pipeValid.js"></script>
<script>
  var pipe = new PipeValid();
  var checkName = pipe.check('name');

  pipe.define('isBear', function(val) {
    return val === 'bear';
  });
  pipe.define('badWord', function(val) {
    return new Promise(function(resolve, reject) {
      setTimeout(function() {
        if (val.indexOf('bad') >= 0) {
          reject();
        } else {
          resolve();
        }
      }, 1000);
    });
  });

  checkName.notEmpty()
    .then()
    .min(3, '名字最少3位');
  pipe.check('name')
    .max(20, '名字不大于20位')
    .define(function(val, arg1){
      console.log('define时，附带参数通过~~', arg1);
      return val.indexOf('熊') >= 0;
    }, '参数1', '必须带上"熊"字!!')
    .badWord('有错误关键字，名字不能带有"bad"');

  pipe.check('age')
    .int('年龄必须是整数');

  pipe.check('address')
    .notEmpty('地址不能空哦');

  pipe.check('list[].name')
    .min(3, '列表的名字，最少3位数');

  // pipe.rule({
  //   name: [
  //     'max', 20, '名字最多20个字'
  //   ],
  //   age: [
  //     ['notEmpty', '年龄不能空'],
  //     ['then'],
  //     ['int', '年龄必须是整数'],
  //     ['max', 2, '年龄最多两位']
  //   ]
  // });

  var result = pipe.start({
    name: 'da宗熊',
    age: '123',
    adress: '河东',
    list: [
      { name: '最少' }
    ]
  });

  // var result = pipe.start({
  //   name: 'da宗熊 bad',
  //   age: '123d'
  // }, ['name', 'age', 'address'], true);

  result.always(function() {
    if (result.pass) {
      console.log('全部成功');
    } else {
      console.error(result.error);
    }
  });

</script>
</body>
</html>
